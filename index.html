<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Task Manager</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%); min-height: 100vh; }
    .app { max-width: 1000px; margin: 0 auto; padding: 40px 20px; }
    .auth-container { max-width: 400px; margin: 60px auto; padding: 30px; background: rgba(255,255,255,0.95); border-radius: 20px; box-shadow: 0 25px 50px rgba(0,0,0,0.2); backdrop-filter: blur(20px); }
    .auth-container h1 { text-align: center; margin-bottom: 24px; color: #333; font-size: 24px; }
    .auth-container form { display: flex; flex-direction: column; gap: 16px; }
    .auth-container input { padding: 12px 16px; border: 1px solid #ddd; border-radius: 6px; font-size: 16px; }
    .auth-container button { padding: 12px; background: #4285f4; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; }
    .auth-container p { text-align: center; margin-top: 16px; color: #4285f4; cursor: pointer; }
    header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; padding: 30px; background: rgba(255,255,255,0.95); border-radius: 20px; backdrop-filter: blur(20px); }
    .app-layout { display: flex; gap: 30px; }
    .left-panel, .right-panel { flex: 1; }
    .add-task { display: flex; gap: 15px; padding: 30px; background: rgba(255,255,255,0.95); border-radius: 20px; backdrop-filter: blur(20px); }
    .add-task input { flex: 1; padding: 16px 20px; border: 2px solid rgba(255,255,255,0.3); border-radius: 12px; font-size: 16px; }
    .add-task button { padding: 16px 30px; background: linear-gradient(135deg, #48bb78 0%, #38a169 100%); color: white; border: none; border-radius: 12px; cursor: pointer; }
    .tasks-section { background: rgba(255,255,255,0.95); border-radius: 20px; padding: 30px; backdrop-filter: blur(20px); }
    .view-tasks-btn { width: 100%; padding: 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 12px; cursor: pointer; margin-bottom: 20px; }
    .task-item { padding: 20px; background: rgba(255,255,255,0.8); border-radius: 12px; border-left: 4px solid #667eea; margin-bottom: 15px; }
    .task-content { display: flex; justify-content: space-between; cursor: pointer; margin-bottom: 10px; }
    .task-actions { display: flex; gap: 10px; }
    .task-actions button { padding: 6px 12px; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; }
    .edit-btn { background: #ffc107; }
    .delete-btn { background: #dc3545; color: white; }
    .save-btn { background: #28a745; color: white; }
    .cancel-btn { background: #6c757d; color: white; }
    .logout-btn { padding: 12px 20px; background: #dc3545; color: white; border: none; border-radius: 12px; cursor: pointer; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script>
    const { useState, useEffect } = React;
    const API_URL = 'https://vexocore-task.vercel.app';
    
    function App() {
      const [token, setToken] = useState(localStorage.getItem('token'));
      const [tasks, setTasks] = useState([]);
      const [newTask, setNewTask] = useState('');
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');
      const [isLogin, setIsLogin] = useState(false);
      const [editingId, setEditingId] = useState(null);
      const [editText, setEditText] = useState('');
      const [showTasks, setShowTasks] = useState(false);

      useEffect(() => {
        if (token) fetchTasks();
      }, [token]);

      const fetchTasks = async () => {
        try {
          const res = await axios.get(`${API_URL}/api/tasks`, {
            headers: { Authorization: `Bearer ${token}` }
          });
          setTasks(res.data);
        } catch (error) {
          console.error('Error fetching tasks:', error);
        }
      };

      const handleAuth = async (e) => {
        e.preventDefault();
        try {
          const endpoint = isLogin ? 'login' : 'register';
          const res = await axios.post(`${API_URL}/api/${endpoint}`, { email, password });
          const newToken = res.data.token;
          setToken(newToken);
          localStorage.setItem('token', newToken);
          setEmail('');
          setPassword('');
        } catch (error) {
          alert(error.response?.data?.error || 'Authentication failed');
        }
      };

      const addTask = async (e) => {
        e.preventDefault();
        if (!newTask.trim()) return;
        try {
          const res = await axios.post(`${API_URL}/api/tasks`, { title: newTask }, {
            headers: { Authorization: `Bearer ${token}` }
          });
          setTasks([...tasks, res.data]);
          setNewTask('');
        } catch (error) {
          console.error('Error adding task:', error);
        }
      };

      const toggleTask = async (id, completed) => {
        try {
          const task = tasks.find(t => t.id === id);
          await axios.put(`${API_URL}/api/tasks/${id}`, { 
            title: task.title, 
            completed: !completed 
          }, {
            headers: { Authorization: `Bearer ${token}` }
          });
          setTasks(tasks.map(t => t.id === id ? { ...t, completed: !completed } : t));
        } catch (error) {
          console.error('Error updating task:', error);
        }
      };

      const deleteTask = async (id) => {
        try {
          await axios.delete(`${API_URL}/api/tasks/${id}`, {
            headers: { Authorization: `Bearer ${token}` }
          });
          setTasks(tasks.filter(t => t.id !== id));
        } catch (error) {
          console.error('Error deleting task:', error);
        }
      };

      const logout = () => {
        setToken(null);
        localStorage.removeItem('token');
        setTasks([]);
      };

      if (!token) {
        return React.createElement('div', { className: 'auth-container' },
          React.createElement('h1', null, 'Task Manager'),
          React.createElement('form', { onSubmit: handleAuth },
            React.createElement('input', {
              type: 'email',
              placeholder: 'Email',
              value: email,
              onChange: (e) => setEmail(e.target.value),
              required: true
            }),
            React.createElement('input', {
              type: 'password',
              placeholder: 'Password',
              value: password,
              onChange: (e) => setPassword(e.target.value),
              required: true
            }),
            React.createElement('button', { type: 'submit' }, isLogin ? 'Login' : 'Register')
          ),
          React.createElement('p', { onClick: () => setIsLogin(!isLogin) },
            isLogin ? 'Need an account? Register' : 'Have an account? Login'
          )
        );
      }

      return React.createElement('div', { className: 'app' },
        React.createElement('header', null,
          React.createElement('h1', null, 'Task Manager'),
          React.createElement('button', { onClick: logout, className: 'logout-btn' }, 'Logout')
        ),
        React.createElement('div', { className: 'app-layout' },
          React.createElement('div', { className: 'left-panel' },
            React.createElement('form', { onSubmit: addTask, className: 'add-task' },
              React.createElement('input', {
                type: 'text',
                placeholder: 'Add new task...',
                value: newTask,
                onChange: (e) => setNewTask(e.target.value)
              }),
              React.createElement('button', { type: 'submit' }, 'Add Task')
            )
          ),
          React.createElement('div', { className: 'right-panel' },
            React.createElement('div', { className: 'tasks-section' },
              React.createElement('button', {
                onClick: () => setShowTasks(!showTasks),
                className: 'view-tasks-btn'
              }, `${showTasks ? 'Hide Tasks' : 'View Tasks'} (${tasks.length})`),
              showTasks && React.createElement('div', { className: 'tasks-container' },
                tasks.length === 0 ? 
                  React.createElement('div', { className: 'no-tasks' }, 'No tasks yet!') :
                  tasks.map(task => 
                    React.createElement('div', { 
                      key: task.id, 
                      className: `task-item ${task.completed ? 'completed' : ''}` 
                    },
                      React.createElement('div', { 
                        className: 'task-content',
                        onClick: () => toggleTask(task.id, task.completed)
                      },
                        React.createElement('span', { className: 'task-text' }, task.title),
                        React.createElement('span', { className: 'task-status' }, task.completed ? '✓' : '○')
                      ),
                      React.createElement('div', { className: 'task-actions' },
                        React.createElement('button', { 
                          onClick: () => deleteTask(task.id),
                          className: 'delete-btn'
                        }, 'Delete')
                      )
                    )
                  )
              )
            )
          )
        )
      );
    }

    ReactDOM.render(React.createElement(App), document.getElementById('root'));
  </script>
</body>
</html>
